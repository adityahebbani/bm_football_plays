{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import{analyzeVideoBackend}from'../api/visionBackend';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Home=()=>{const[uploadedVideo,setUploadedVideo]=useState(null);const[analysisResults,setAnalysisResults]=useState(null);const videoRef=useRef(null);const canvasRef=useRef(null);// File upload handler\nconst handleFileChange=async event=>{var _event$target$files;const selectedFile=(_event$target$files=event.target.files)===null||_event$target$files===void 0?void 0:_event$target$files[0];if(!selectedFile)return;const formData=new FormData();formData.append('file',selectedFile);try{// Upload file to /api/upload\nconst response=await fetch('/api/upload',{method:'POST',body:formData});if(response.ok){const data=await response.json();setUploadedVideo(data);// Trigger backend analysis if video is an MP4\nif(data.isVideo&&selectedFile.type==='video/mp4'){const results=await analyzeVideoBackend(selectedFile);setAnalysisResults(results);}}else{alert('Upload failed.');}}catch(err){console.error('Error uploading file:',err);}};// Overlay bounding boxes on the video as it plays.\nuseEffect(()=>{const videoEl=videoRef.current;const canvasEl=canvasRef.current;if(!videoEl||!canvasEl)return;const ctx=canvasEl.getContext('2d');if(!ctx)return;const handleLoadedMetadata=()=>{canvasEl.width=videoEl.videoWidth;canvasEl.height=videoEl.videoHeight;};const updateOverlay=()=>{var _result$prediction;ctx.clearRect(0,0,canvasEl.width,canvasEl.height);if(!analysisResults)return;const currentTime=videoEl.currentTime;// Find predictions with timestamps near the current time (within ±0.5s)\nconst result=analysisResults.find(res=>Math.abs(res.timestamp-currentTime)<0.5);if(result!==null&&result!==void 0&&(_result$prediction=result.prediction)!==null&&_result$prediction!==void 0&&_result$prediction.predictions){result.prediction.predictions.forEach(pred=>{ctx.strokeStyle='red';ctx.lineWidth=2;ctx.strokeRect(pred.x,pred.y,pred.width,pred.height);ctx.font='16px Arial';ctx.fillStyle='red';ctx.fillText(pred.label,pred.x,pred.y-5);});}};videoEl.addEventListener('loadedmetadata',handleLoadedMetadata);videoEl.addEventListener('timeupdate',updateOverlay);return()=>{videoEl.removeEventListener('loadedmetadata',handleLoadedMetadata);videoEl.removeEventListener('timeupdate',updateOverlay);};},[analysisResults]);return/*#__PURE__*/_jsxs(\"div\",{className:\"home-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Upload and View on Home Page\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"upload-section\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"file-input\",className:\"file-upload-label\",children:\"Choose File\"}),/*#__PURE__*/_jsx(\"input\",{id:\"file-input\",type:\"file\",accept:\"image/*,video/*\",onChange:handleFileChange,className:\"hidden-file-input\"})]}),uploadedVideo&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'20px',position:'relative',display:'inline-block'},children:[/*#__PURE__*/_jsx(\"h3\",{children:uploadedVideo.name}),uploadedVideo.isVideo?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"video\",{ref:videoRef,width:\"400\",controls:true,children:[/*#__PURE__*/_jsx(\"source\",{src:uploadedVideo.path,type:\"video/mp4\"}),\"Your browser does not support the video tag.\"]}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,style:{position:'absolute',top:0,left:0,pointerEvents:'none'}})]}):/*#__PURE__*/_jsx(\"img\",{src:uploadedVideo.path,alt:uploadedVideo.name,width:\"400\"})]})]});};export default Home;","map":{"version":3,"names":["React","useState","useRef","useEffect","analyzeVideoBackend","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Home","uploadedVideo","setUploadedVideo","analysisResults","setAnalysisResults","videoRef","canvasRef","handleFileChange","event","_event$target$files","selectedFile","target","files","formData","FormData","append","response","fetch","method","body","ok","data","json","isVideo","type","results","alert","err","console","error","videoEl","current","canvasEl","ctx","getContext","handleLoadedMetadata","width","videoWidth","height","videoHeight","updateOverlay","_result$prediction","clearRect","currentTime","result","find","res","Math","abs","timestamp","prediction","predictions","forEach","pred","strokeStyle","lineWidth","strokeRect","x","y","font","fillStyle","fillText","label","addEventListener","removeEventListener","className","children","htmlFor","id","accept","onChange","style","marginTop","position","display","name","ref","controls","src","path","top","left","pointerEvents","alt"],"sources":["C:/Users/Adi/Files/Projects/bm_football_plays/computer-vision-webapp/src/components/Home.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { analyzeVideoBackend, VideoAnalysisResult } from '../api/visionBackend';\r\n\r\ninterface VideoData {\r\n  id: string;\r\n  name: string;\r\n  path: string;\r\n  timestamp: number;\r\n  isVideo: boolean;\r\n}\r\n\r\nconst Home: React.FC = () => {\r\n  const [uploadedVideo, setUploadedVideo] = useState<VideoData | null>(null);\r\n  const [analysisResults, setAnalysisResults] = useState<VideoAnalysisResult[] | null>(null);\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n  // File upload handler\r\n  const handleFileChange = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const selectedFile = event.target.files?.[0];\r\n    if (!selectedFile) return;\r\n\r\n    const formData = new FormData();\r\n    formData.append('file', selectedFile);\r\n\r\n    try {\r\n      // Upload file to /api/upload\r\n      const response = await fetch('/api/upload', {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data: VideoData = await response.json();\r\n        setUploadedVideo(data);\r\n\r\n        // Trigger backend analysis if video is an MP4\r\n        if (data.isVideo && selectedFile.type === 'video/mp4') {\r\n          const results = await analyzeVideoBackend(selectedFile);\r\n          setAnalysisResults(results);\r\n        }\r\n      } else {\r\n        alert('Upload failed.');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error uploading file:', err);\r\n    }\r\n  };\r\n\r\n  // Overlay bounding boxes on the video as it plays.\r\n  useEffect(() => {\r\n    const videoEl = videoRef.current;\r\n    const canvasEl = canvasRef.current;\r\n    if (!videoEl || !canvasEl) return;\r\n\r\n    const ctx = canvasEl.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    const handleLoadedMetadata = () => {\r\n      canvasEl.width = videoEl.videoWidth;\r\n      canvasEl.height = videoEl.videoHeight;\r\n    };\r\n\r\n    const updateOverlay = () => {\r\n      ctx.clearRect(0, 0, canvasEl.width, canvasEl.height);\r\n      if (!analysisResults) return;\r\n      const currentTime = videoEl.currentTime;\r\n\r\n      // Find predictions with timestamps near the current time (within ±0.5s)\r\n      const result = analysisResults.find(\r\n        (res) => Math.abs(res.timestamp - currentTime) < 0.5\r\n      );\r\n\r\n      if (result?.prediction?.predictions) {\r\n        result.prediction.predictions.forEach((pred: any) => {\r\n          ctx.strokeStyle = 'red';\r\n          ctx.lineWidth = 2;\r\n          ctx.strokeRect(pred.x, pred.y, pred.width, pred.height);\r\n          ctx.font = '16px Arial';\r\n          ctx.fillStyle = 'red';\r\n          ctx.fillText(pred.label, pred.x, pred.y - 5);\r\n        });\r\n      }\r\n    };\r\n\r\n    videoEl.addEventListener('loadedmetadata', handleLoadedMetadata);\r\n    videoEl.addEventListener('timeupdate', updateOverlay);\r\n\r\n    return () => {\r\n      videoEl.removeEventListener('loadedmetadata', handleLoadedMetadata);\r\n      videoEl.removeEventListener('timeupdate', updateOverlay);\r\n    };\r\n  }, [analysisResults]);\r\n\r\n  return (\r\n    <div className=\"home-container\">\r\n      <h2>Upload and View on Home Page</h2>\r\n      <div className=\"upload-section\">\r\n        <label htmlFor=\"file-input\" className=\"file-upload-label\">\r\n          Choose File\r\n        </label>\r\n        <input\r\n          id=\"file-input\"\r\n          type=\"file\"\r\n          accept=\"image/*,video/*\"\r\n          onChange={handleFileChange}\r\n          className=\"hidden-file-input\"\r\n        />\r\n      </div>\r\n\r\n      {uploadedVideo && (\r\n        <div style={{ marginTop: '20px', position: 'relative', display: 'inline-block' }}>\r\n          <h3>{uploadedVideo.name}</h3>\r\n          {uploadedVideo.isVideo ? (\r\n            <>\r\n              <video ref={videoRef} width=\"400\" controls>\r\n                <source src={uploadedVideo.path} type=\"video/mp4\" />\r\n                Your browser does not support the video tag.\r\n              </video>\r\n              <canvas\r\n                ref={canvasRef}\r\n                style={{\r\n                  position: 'absolute',\r\n                  top: 0,\r\n                  left: 0,\r\n                  pointerEvents: 'none',\r\n                }}\r\n              />\r\n            </>\r\n          ) : (\r\n            <img src={uploadedVideo.path} alt={uploadedVideo.name} width=\"400\" />\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Home;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}